<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Momentree</title>

        <meta property="og:title" content="Momentree" />
        <meta property="og:type" content="website" />
        <!-- <meta property="og:description" content="198枚の短冊のアーカイブ"> -->

        <!-- <meta property="og:url" content="https://tsub-o8.github.io/Momentree/" /> -->
        <meta property="og:image" content="https://tsub-o8.github.io/Momentree/img/ogp.jpg" />

        <meta property="og:site_name" content="Momentree" />
        <meta name="twitter:card" content="summary_large_image" />

        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />

        <script>
            (function(d) {
                var config = {
                kitId: 'ouz5wlt',
                scriptTimeout: 3000,
                async: true
                },
                h=d.documentElement,t=setTimeout(function(){h.className=h.className.replace(/\bwf-loading\b/g,"")+" wf-inactive";},config.scriptTimeout),tk=d.createElement("script"),f=false,s=d.getElementsByTagName("script")[0],a;h.className+=" wf-loading";tk.src='https://use.typekit.net/'+config.kitId+'.js';tk.async=true;tk.onload=tk.onreadystatechange=function(){a=this.readyState;if(f||a&&a!="complete"&&a!="loaded")return;f=true;clearTimeout(t);try{Typekit.load(config)}catch(e){}};s.parentNode.insertBefore(tk,s)
            })(document);
        </script>

        <style>
            body {
                font-family: "avenir-lt-pro", "dnp-shuei-gothic-gin-std", sans-serif;
                font-weight: 400;
                font-style: normal;

                margin: 0;
                background-color: #fffcf5;
                height: 100dvh;
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                overflow: hidden;
            }

            #login-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: #141e1f;
                z-index: 9999;

                display: flex;
                justify-content: center;
                align-items: center;
            }

            .login-box {
                text-align: center;
            }

            .login-box h2 {
                font-size: 24px;
                letter-spacing: 3px;
                margin-bottom: 3.6vh;
                color: #fffcf5;
            }

            .login-box input {
                display: block;
                margin: 20px auto;
                padding: 5px 10px;
                width: 200px;

                background: transparent;
                border: none;
                border-bottom: 1px solid #fffcf5;
                outline: none;

                font-family: inherit;
                font-size: 16px;
                color: #fffcf5;
            }

            #login-btn {
                margin: 2vh auto 0;

                width: 36px;
                height: 36px;
                
                flex-shrink: 0;
                padding: 0;

                border-radius: 50%;
                border: none;
                background-color: #141e1f;
                
                display: flex;
                justify-content: center;
                align-items: center;
                
                cursor: pointer;
                transition: transform 0.1s;

            }

            #login-btn img {
                width: 100%;
                height: 100%;

                object-fit: contain;
                overflow: hidden;
                
                margin: 0;
                display: block;
            }

            #login-btn:active {
                transform: scale(0.95);
            }

            #error-msg {
                color: #ce4c40;
                font-size: 12px;
                letter-spacing: 1px;
                margin: 1vh;
                height: 20px;
            }

             #title {
                margin: 0;
                margin-bottom: 6vh;

                font-size: 24px;
                font-weight: normal;
                letter-spacing: 4px;

                color: #141e1f;

                z-index: 100;
            }

            .swiper {
                height: 60vh;
                width: calc(60vh * (300/899));
                
                aspect-ratio: 300/899;

                max-width: 85vw;
                max-height: 80vh;

                overflow: visible;
            }

            .swiper-slide {
                width: 100%;
                height: 100%;

                display: flex;
                justify-content: center;
                align-items: center;
            }

            .swiper-slide-active .card .card-face {
                filter: blur(0) brightness(1);
            }

            .card {
                width: 100%;
                height: 100%;
                
                position: relative;
                transform-style: preserve-3d;

                transition: transform 0.6s;

                cursor: pointer;

            }

            .card.is-flipped {
                transform: rotateY(180deg);
            }

            .card-face {
                position: absolute;

                width: 100%;
                height: 100%;

                border-radius: 2px;

                background-size: cover;
                background-position: center;

                backface-visibility: hidden;
                overflow: hidden;

                transition: filter 0.6s;
                filter: blur(5px) brightness(0.96);
            }

            .card-face img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }

            .card-back {
                transform: rotateY(180deg);
            }

           

            #counter {
                margin-top: 3vh;
                z-index: 100;

                font-size: 12px;
                color: #888;
                letter-spacing: 2px;
            }

            #random-btn {
                margin-top: 3.2vh;
                z-index: 100;

                width: 36px;
                height: 36px;
                
                flex-shrink: 0;
                padding: 0;

                border-radius: 50%;
                border: none;
                background-color: #fffcf5;
                
                display: flex;
                justify-content: center;
                align-items: center;
                
                cursor: pointer;
                transition: transform 0.1s;

            }

            #random-btn img {
                width: 100%;
                height: 100%;

                object-fit: contain;
                overflow: hidden;
                
                margin: 0;
                display: block;
            }

            #random-btn:active {
                transform: scale(0.95);
            }
        </style>

        
    </head>

    <body>

        <div id="login-overlay">
            <div class="login-box">
                <h2>Momentree</h2>
                <input type="text" id="user-id" placeholder="ID">
                <input type="password" id="user-pass" placeholder="Password">
                <p id="error-msg"></p>
                <button id="login-btn" aria-label="Enter">
                    <img src="img/enter.svg" alt="enter icon">
                </button>
            </div>
        </div>

        <h1 id="title">Momentree</h1>

        <div class="swiper">
            <div class="swiper-wrapper" id="card-container"></div>
        </div>

        <div id="counter"></div>

        <button id="random-btn" aria-label="Shuffle">
            <img src="img/shuffle.svg" alt="shuffle icon">
        </button>

        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

        <script>
            const CORRECT_ID_HASH = "3311ad5d72067f3e04afdc83bffd6ba5129a0f4c6cd3ff762131f7fc9f0ef3a5"
            const CORRECT_PASS_HASH = "829e4d65e6ef4a2c03bb2cabf1221f05940fddc59f899a77137328890e06b053";

            const loginOverlay = document.getElementById('login-overlay');
            const loginBtn = document.getElementById('login-btn');
            const idInput = document.getElementById('user-id');
            const passInput = document.getElementById('user-pass');
            const errorMsg = document.getElementById('error-msg');

            const sha256 = async (text) => {
                const uint8 = new TextEncoder().encode(text);
                const digest = await crypto.subtle.digest('SHA-256', uint8);
                return Array.from(new Uint8Array(dagest)).map(v => v.toString(16).padStart(2,'0')).join('');
            };

            const tryLogin = async () => {
                const inputID = idInput.value;
                const inputPass = passInput.value;

                const idHash = await sha256(inputID);
                const passHash = await sha256(inputPass)

                if (idHash === CORRECT_ID_HASH && passHash === CORRECT_PASS_HASH) {
                    loginOverlay.style.transition = "opacity 0.5s";
                    loginOverlay.style.opacity = "0";

                    setTimeout (() => {
                        loginOverlay.style.display = "none";
                    }, 500);
                } else {
                    errorMsg.innerText = "IDかパスワードが間違っています";
                    passInput.value = "";
                }
            };

            loginBtn.addEventListener('click', tryLogin);

            passInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') tryLogin();
            });


            const totalCards = 198;

            const slidesData = [];

            for (let i = 1; i <= totalCards; i++) {
                let frontNum = (i * 2) - 1;
                let backNum = (i *2);

                let frontNumStr = String(frontNum).padStart(3, '0');
                let backNumStr = String(backNum).padStart(3, '0');

                slidesData.push({
                    frontSrc: `img/card-${frontNumStr}.jpg`,
                    backSrc: `img/card-${backNumStr}.jpg`,
                    id: i
                });
            }

            const randomStartIndex = Math.floor(Math.random() * totalCards);

            const swiper = new Swiper('.swiper', {
                effect: 'cards',
                grabCursor: true,
                centeredSlides: true,
                
                slidesPerView: 1,
                loop: true,
                initialSlide: randomStartIndex,
                keyboard: false,

                preloadImages: false,
                updateOnImagesReady: false,

                virtual: {
                    slides: slidesData,
                    addSlidesBefore: 2,
                    addSlidesAfter: 2,

                    renderSlide: function (slideContent, index) {
                        return `
                            <div class="swiper-slide">
                                <div class="card">
                                    <div class="card-face card-front">
                                        <img src="${slideContent.frontSrc}" alt="front">
                                    </div>
                                    <div class="card-face card-back">
                                        <img src="${slideContent.backSrc}" alt="back">
                                    </div>
                                </div>
                            </div>
                        `;
                    },
                },

                cardsEffect: {
                    slideShadows: false,
                    perSlideOffset: 40,
                    perSlideRotate: 2,
                },


                on: {
                    slideChange: function () {
                        const flippedCards = document.querySelectorAll('.card.is-flipped');
                        flippedCards.forEach(card => card.classList.remove('is-flipped'));

                        const counter = document.getElementById('counter');
                        const current = this.realIndex + 1;
                        counter.innerText = `${current} / ${totalCards}`
                    }
                }
            });

            document.addEventListener('keydown', (e) => {

                if (e.key === 'ArrowRight') {
                    e.preventDefault();

                    const activeSlide = swiper.el.querySelector('.swiper-slide-active');
                    if (activeSlide) {
                        const card = activeSlide.querySelector('.card');
                        if (card) {
                            if (card.classList.contains('is-flipped')) {
                                swiper.slideNext();
                            } else {
                                card.classList.add('is-flipped');
                            }
                        }
                    }
                }

                if (e.key === 'ArrowLeft') {
                    swiper.slidePrev();
                }
            });

            document.addEventListener('click', (e) => {
                if (swiper.touchEventsData.isMoved) return;

                const activeSlide = swiper.el.querySelector('.swiper-slide-active');
                
                if (activeSlide) {
                        const activeCard = activeSlide.querySelector('.card');
                    if (activeCard) {
                        activeCard.classList.toggle('is-flipped');
                    }
                }
            });

            const counterElement = document.getElementById('counter');
            counterElement.innerText = `${swiper.realIndex + 1} / ${totalCards}`;

            const randomBtn = document.getElementById('random-btn');
            let isShuffling = false;

            randomBtn.addEventListener('click', (e) => {
                e.stopPropagation();

                if (isShuffling) return;
                isShuffling = true;

                const targetIndex = Math.floor(Math.random() * totalCards);
                const runUpCount = 20;

                let startIndex = targetIndex - runUpCount;
                if (startIndex < 0) startIndex = totalCards + startIndex;

                swiper.slideToLoop(startIndex, 0);

                let currentStep = 0;

                const moveNext = () => {
                    if (currentStep >= runUpCount) {
                        isShuffling = false;
                        return;
                    }

                    const progress = currentStep / runUpCount;

                    const minSpeed = 10;
                    const maxSpeed = 80;

                    const delay = minSpeed + (maxSpeed - minSpeed) * Math.pow(progress, 2);

                    swiper.slideNext(delay);

                    currentStep++;

                    setTimeout(moveNext, delay);
                };

                moveNext();
            });

        </script>
    </body>
</html> 